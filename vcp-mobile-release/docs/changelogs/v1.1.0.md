# VCPMobile v1.1.0 更新日志

**发布日期**: 2026-02-12

## 一、功能变更

### 新增功能

- **消息操作菜单**: 长按聊天消息弹出底部 ActionSheet 菜单，包含以下操作：
  - **复制文本**: 将消息原始文本复制到剪贴板
  - **编辑消息**: 弹出编辑框修改消息内容，保存后同步到桌面端
  - **阅读模式**: 全屏展示消息内容，适合阅读长文本，支持 Markdown 渲染
  - **转发消息**: 选择目标 Agent，将消息转发到该 Agent 的新话题中（自动同步到桌面端）
  - **删除消息**: 从聊天记录中删除该消息，同步到桌面端

### 修复问题

- **天气插件 403 错误**: 修复 WeatherReporter 插件城市查询 API 使用了错误的 host（`devapi.qweather.com`），正确 host 应为 `geoapi.qweather.com`，导致 QWeather 返回 403 Invalid Host 错误

## 二、技术实现

### 代码变更（VCPMobile 前端）

- `src/App.vue` — 新增消息操作菜单逻辑：
  - `actionSheetVisible` / `actionSheetMessage` 控制菜单显隐和目标消息
  - `onMsgTouchStart` / `onMsgTouchEnd` 长按 500ms 触发
  - `doCopyMessage` 复制到剪贴板
  - `doDeleteMessage` 删除消息 + 同步桌面端（调用 appendToHistory 重写整个话题）
  - `openReadMode` / `closeReadMode` 全屏阅读模式
  - `openEditMode` / `saveEditMessage` / `cancelEditMode` 编辑消息
  - `openForwardPicker` / `doForwardMessage` / `closeForwardPicker` 转发消息到其他 Agent
- `src/style.css` — 新增样式：
  - `.action-sheet-*` 底部弹出菜单（带 slideUp 动画）
  - `.read-mode-*` 全屏阅读模式
  - `.edit-mode-*` 编辑消息弹窗
  - `.forward-picker-*` 转发 Agent 选择器

### VCPToolBox 修复

- `Plugin/WeatherReporter/weather-reporter.js` — 第93行：城市查询 URL 从 `https://${weatherUrl}/geo/v2/city/lookup` 改为固定的 `https://geoapi.qweather.com/geo/v2/city/lookup`

## 三、依赖项目变更

### VCPToolBox 需要的改动

| 文件 | 操作 | 说明 |
|------|------|------|
| `Plugin/WeatherReporter/weather-reporter.js` | **替换** | 修复城市查询 API host 错误（403 Invalid Host） |

其余 VCPMobile 相关文件（routes、WebSocketServer、ChatSync 插件）与 v1.0.0 相同，无变化。

### VCPChat 需要的改动

本次无需改动。
