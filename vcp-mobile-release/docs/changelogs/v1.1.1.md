# VCPMobile v1.1.1 更新日志

**发布日期**: 2026-02-14

## 一、功能变更

### 修复问题

- **天气插件 QWeather API 全面适配新版认证**：修复 WeatherReporter 插件所有 API 调用（城市查询、当前天气、N天预报、24小时预报、天气预警、月相、空气质量、太阳角度），从旧版 URL 参数 `key=xxx` 认证切换为 `X-QW-Api-Key` 请求头认证，适配 QWeather 新版独立 API Host 体系
- **空气质量 API 路径和响应格式更新**：同步上游改动，空气质量接口从 `/v7/air/now` 迁移到 `/airquality/v1/current/{lat}/{lon}`，响应解析适配新格式（`indexes` + `pollutants` 结构）

## 二、技术实现

### 代码变更（VCPToolBox 插件）

- `Plugin/WeatherReporter/weather-reporter.js` — 8 处 API 调用全部改造：
  - URL 中移除 `&key=${weatherKey}` 参数
  - fetch 请求添加 `headers: { 'X-QW-Api-Key': weatherKey }`
  - GEO 城市查询统一使用 `weatherUrl` 作为 host（路径 `/geo/v2/city/lookup`）
  - 空气质量 API 路径改为 `/airquality/v1/current/${lat}/${lon}`
  - 空气质量响应解析适配新格式（从 `data.now` 改为 `data.indexes` + `data.pollutants`）

### 配置变更

- `config.env.example` — 更新 WeatherUrl 说明，指引用户使用新版独立 API Host（形如 `xxx.re.qweatherapi.com`），旧版 `devapi`/`geoapi` 域名已停用

## 三、依赖项目变更

### VCPToolBox 需要的改动

| 文件 | 操作 | 说明 |
|------|------|------|
| `Plugin/WeatherReporter/weather-reporter.js` | **替换** | 全面适配 QWeather 新版 API Host + 请求头认证 + 空气质量新接口 |

用户还需在 `config.env` 中将 `WeatherUrl` 改为 QWeather 控制台分配的独立 API Host。

### VCPChat 需要的改动

本次无需改动。
