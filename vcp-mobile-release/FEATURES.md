# VCPMobile 功能介绍

**版本**: v1.2.0 | **更新日期**: 2026-02-17

VCPMobile 是 VCPChat 桌面端的手机伴侣应用，让你随时随地与 AI 对话，手机和电脑之间无缝衔接。

---

## 一、AI 对话

### 流式对话
- 支持与 AI 实时流式对话，逐字输出
- 可随时点击「停止」中断生成
- 支持多模型切换（从 VCPToolBox 获取可用模型列表）

### 思维链展示 ✨ *v1.2.0 新增*
- 当模型返回思考过程（如 DeepSeek 等支持 `reasoning_content` 的模型），AI 回复气泡顶部会出现可折叠的「💭 思考过程」区域
- 流式输出时自动展开显示"思考中..."，回复完成后自动折叠
- 点击即可展开/收起，查看 AI 的完整推理过程

### 重新生成
- 对 AI 回复不满意时，可长按气泡选择「重新回复」
- 重新生成同样支持思维链展示

### 消息编辑
- 长按任意消息气泡，可编辑消息内容
- 编辑后保存，支持双向同步到桌面端

---

## 二、多 Agent 系统

### Agent 列表
- 从 VCPToolBox 服务端同步 Agent 列表
- 侧边栏展示所有可用 Agent，点击即可切换
- 每个 Agent 有独立的模型、温度、最大输出 Token 等参数配置

### 话题管理
- 每个 Agent 下支持多话题（类似对话分组）
- 新建、切换、删除话题
- 话题双向同步到桌面端 VCPChat
- 话题标题根据首条消息自动生成

---

## 三、跨设备同步

### 聊天记录同步
- **手机 → 桌面**：手机发送的消息和 AI 回复自动追加到桌面端 `history.json`
- **桌面 → 手机**：切换话题时自动拉取桌面端最新消息
- **增量同步**：基于 `lastModified` 时间戳，只同步变化的内容
- **IndexedDB 缓存**：本地缓存聊天记录，切换话题秒开

### 话题同步
- 手机新建的话题自动出现在桌面端
- 手机删除话题同步删除桌面端数据（config.json + 话题目录）
- 桌面端删除的话题在手机刷新后自动消失

### 消息去重 ✨ *v1.2.0 增强*
- 合并消息时按 `role + content前缀 + timestamp` 去重
- 防止网络抖动导致的重复消息

---

## 四、富文本渲染

### Markdown 渲染
- 完整支持 Markdown 语法：标题、列表、粗体、斜体、链接、图片等
- 代码块语法高亮
- 表格渲染
- 引用块样式

### VCP 富文本气泡
- 支持 VCPChat 的 `vcp-root` 富文本格式
- 通过 iframe 沙箱隔离渲染，支持交互式按钮、自定义样式
- 沙箱内的 `input()` 函数可直接触发聊天输入

### 表情图/贴纸
- 正确显示 AI 回复中的表情图（`<img>` 标签）
- 自动修复表情图 URL（localhost 替换、认证前缀注入、相对路径补全）

### 渐进渲染
- 历史消息采用渐进渲染队列，优先渲染最新消息
- 避免一次性渲染大量消息导致 UI 卡顿

---

## 五、附件与多媒体

### 附件发送
- 支持发送图片、音频、视频、文件等附件
- 附件预览：图片显示缩略图，视频支持播放控件

### 语音输入
- 长按录音按钮进行语音输入
- 录音自动转文字发送

### 截图发送
- 系统截图自动检测，可一键发送给 AI 分析
- 支持自定义截图预设消息

---

## 六、消息操作

长按消息气泡弹出操作菜单：

| 操作 | 说明 |
|------|------|
| **编辑消息** | 修改消息内容 |
| **复制文本** | 复制消息纯文本到剪贴板 |
| **创建分支** | 从当前消息创建新的对话分支 |
| **转发消息** | 将消息转发到其他 Agent |
| **朗读气泡** | TTS 朗读 AI 回复内容 |
| **保存为图片** | 将消息气泡截图保存到相册 |
| **阅读模式** | 全屏查看消息内容 |
| **重新回复** | 重新生成 AI 回复（仅 AI 消息） |
| **删除消息** | 删除当前消息 |

---

## 七、界面与个性化

### 主题
- 暗色主题（默认）/ 亮色主题切换
- Agent 气泡主题：启用后 AI 回复使用富文本气泡样式

### 壁纸
- 18 张内置壁纸可选
- 支持从 VCPChat 桌面端同步壁纸
- 壁纸模式下消息气泡自动半透明毛玻璃效果

### 消息显示
- 显示发送者头像（首字母）、昵称、时间戳
- 用户消息靠右、AI 消息靠左
- 流式输出时显示"模型正在响应..."横幅

---

## 八、WebSocket 推送

- 实时接收 VCPToolBox 服务端推送
- 支持接收桌面端发来的消息通知
- 自动重连机制

---

## 九、性能优化 ✨ *v1.2.0 增强*

### 沙箱分批挂载
- 历史消息的富文本沙箱（iframe）分批挂载，每 3 个让出一次事件循环
- 避免切换话题时 CPU 独占导致 UI 冻结

### 缓存策略
- **Agent 列表**：localStorage 缓存，启动秒加载，后台异步刷新
- **聊天记录**：IndexedDB 缓存 + lastModified 增量同步
- **本地消息**：`isLocal` 标记优先保留本地版本，不被服务端简化版覆盖

---

## 十、技术栈

| 组件 | 技术 |
|------|------|
| 前端框架 | Vue 3 (Composition API) |
| 构建工具 | Vite |
| 移动端框架 | Capacitor |
| Markdown | marked |
| HTML 净化 | DOMPurify |
| 截图 | html2canvas |
| 缓存 | IndexedDB + localStorage |
| 通信 | HTTP REST + WebSocket |

---

## 十一、配置说明

打开 App → 设置，需要配置：

| 配置项 | 说明 | 示例 |
|--------|------|------|
| 接口地址 | VCPToolBox 服务地址 | `http://192.168.1.100:6005` |
| API 密钥 | VCPToolBox 访问密钥 | 内网可留空 |
| 模型 | 默认对话模型 | 从服务端拉取列表选择 |
| 管理面板用户名 | 跨设备同步认证 | AdminPanel 用户名 |
| 管理面板密码 | 跨设备同步认证 | AdminPanel 密码 |
| Agent 气泡主题 | 启用富文本气泡 | 开/关 |
| 截图预设消息 | 截图发送时的默认提示 | "识别截图内容并记录日记" |
